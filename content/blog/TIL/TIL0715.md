---
title: 'TIL 210715'
date: 2021-07-16 00:16:13
category: 'TIL'
draft: false
---

### React useEffect() only run on first render with dependencies

ì»´í¬ë„ŒíŠ¸ ë‚´, mountì‹œì—ë§Œ ì‹¤í–‰ì‹œí‚¤ê³  ì‹¶ì€ effectë¥¼ custom hooksë¡œ ë§Œë“¤ì—ˆë‹¤. effect ë‚´ì—ì„œ ì‚¬ìš©ë˜ì–´ì•¼ í•˜ëŠ” ê°’ë“¤ì„ dependencies arrayì— ì¶”ê°€í•´ì£¼ë‹ˆ array ë‚´ì— í¬í•¨ëœ ê°’ì´ ë³€ê²½ë  ë•Œ ë¿ë§Œ ì•„ë‹ˆë¼, ì»´í¬ë„ŒíŠ¸ ë‚´ ë‹¤ë¥¸ stateê°€ ë³€ê²½ë˜ì–´ re-render ë  ë•Œë§ˆë‹¤ effectê°€ ì‹¤í–‰ë˜ê³  ìˆì—ˆë‹¤. ğŸ¤”

ì´ hooksì—ì„œëŠ” ë°ì´í„°ë¥¼ fetch í›„ action ì„ dispatch í•˜ëŠ” ë¡œì§ì´ ìˆì—ˆëŠ”ë° actionì´ ë¶ˆí•„ìš”í•˜ê²Œ ìì£¼ dispatch ë˜ëŠ” ê±¸ ë³´ê³  ì•Œ ìˆ˜ ìˆì—ˆë‹¤.

ê·¸ë ‡ë‹¤ê³  dependencies array ë¥¼ `[]`ë¡œ ë„£ì–´ì£¼ë‹ˆ Reactê°€ useEffectì— dependencyê°€ ë¹ ì¡Œë‹¤ê³  í•„ìš”í•œ ê²ƒë“¤ ë‹¤ arrayì— ì¶”ê°€í•˜ë˜ì§€ ì•„ë‹ˆë©´ arrayë¥¼ ì—†ì• ë˜ì§€ ë‘˜ ì¤‘ì— í•˜ë‚˜ë¥¼ í•˜ë¼ëŠ” warningì„ ë³´ì—¬ì¤¬ë‹¤; (ë‘˜ ë‹¤ ë‚´ê°€ ì›í•˜ëŠ”ê²Œ ì•„ë‹Œë°..)

ì°¾ì•„ë³´ë‹ˆ [useRef, useStateë¡œ didLoad ê°™ì€ ê°’ì„ ë§Œë“¤ì–´ì„œ useEffect ë‚´ì—ì„œ í•œë²ˆë§Œ ì‹¤í–‰ë˜ê²Œ ë§Œë“œëŠ” ë°©ë²•](https://stackoverflow.com/questions/58054438/react-useeffect-only-run-on-first-render-with-dependencies?rq=1)ì„ ì•Œë ¤ì¤¬ë‹¤. ê³¼ì—° ì´ ë°©ë²•ì´ ìµœì„ ì¼ê¹Œ?

**ê¶ê¸ˆì¦ 1**
dependencies arrayê°€ [] ì¼ ë•ŒëŠ” mount í›„ì— í•œë²ˆ ë¡œì§ì´ ì‹¤í–‰ë˜ëŠ” ê±°ë¼ ì´í•´í•˜ì§€ë§Œ, dependecies arrayì— íŠ¹ì • ê°’ì´ ìˆì„ ë•ŒëŠ” ì™œ ì»´í¬ë„ŒíŠ¸ê°€ re-render ë  ë•Œë§ˆë‹¤ useEffectê°€ ì‹¤í–‰ë˜ëŠ” ê±¸ê¹Œ?

**ê¶ê¸ˆì¦ 2**
mount ì‹œì—ë§Œ redux actionì„ dispatch í•´ì•¼ í•˜ëŠ” ê²½ìš° didLoad ê°™ì€ ê°’ì„ ë§Œë“¤ì–´ì„œ !didLoad ì¼ë•Œë§Œ ë¡œì§ì„ ì‹¤í–‰ì‹œí‚¤ë„ë¡ í•˜ëŠ” ë°©ë²• ì™¸ì— ë­ê°€ ìˆì„ê¹Œ?

**ë‚´ê°€ ì˜ëª»í•˜ê³  ìˆì—ˆë˜ ì **
useEffect ë‚´ì—ì„œ ì‚¬ìš©í•˜ëŠ” ê°’ì€ `folder.folderId` , `folder.resourceList` ì˜€ëŠ”ë° dependencies arrayì— `folder`ë¥¼ ë„£ì–´ì£¼ê³  ìˆì—ˆë‹¤. ì œëŒ€ë¡œ ìœ„ì˜ ê°’ë“¤ì„ ë„£ì–´ì£¼ë‹ˆ ë¶ˆ í•„ìš”í•˜ê²Œ useEffectê°€ ì‹¤í–‰ë˜ì§€ ì•Šì•˜ë‹¤.

```js
// NO
const useCheck = folder => {
  useEffect(() => {
    if (folder.folderId) {
      getAddedByExtension(folder.resourceList)
    }
  }, [folder])
}

// YES!
const useCheck = folder => {
  useEffect(() => {
    if (folder.folderId) {
      getAddedByExtension(folder.resourceList)
    }
  }, [folder.folderId, folder.resourceList])
}
```

dependencies arrayì— objectë¥¼ ë„£ì–´ì£¼ë©´ objectì˜ referenceë¥¼ ë¹„êµí•´ì„œ effectë¥¼ ì‹¤í–‰ì‹œí‚¬ì§€ ë§ì§€ íŒë‹¨í•œë‹¤. í•˜ì§€ë§Œ objectê°€ ìƒˆë¡œ ìƒì„±ë˜ì—ˆëŠ”ì§€ ì•„ë‹Œì§€ëŠ” ë³´ì¥í•˜ì§€ ëª»í•œë‹¤. object ë‚´ì˜ ëª‡ ê°€ì§€ properties ë“¤ì„ ì‚¬ìš©í•˜ê³  ìˆê³  ê·¸ ê°’ì´ primitive type ì´ê¸° ë•Œë¬¸ì— ì´ ê°’ë“¤ì„ dependencies arrayì— ì¶”ê°€í•´ì¤˜ì•¼ í•œë‹¤.

useEffect ë‚´ì—ì„œ ì‚¬ìš©í•˜ëŠ” object ê°’ë“¤ì„ ìœ„í•´ objectë¥¼ ë„˜ê²¨ì£¼ì§€ ë§ê³ , ì •í™•í•œ property ë“¤ì„ dependency arrayì— ì¶”ê°€í•˜ì.

ì°¸ê³ : https://www.benmvp.com/blog/object-array-dependencies-react-useEffect-hook/

### firestore batch, transaction

- transaction : 1ê°œ ì´ìƒì˜ ë¬¸ì„œì— ëŒ€í•œ ì½ê¸° ë° ì“°ê¸° ì‘ì—…
- batch: 1ê°œ ì´ìƒì˜ ë¬¸ì„œì— ëŒ€í•œ ì“°ê¸° ì‘ì—…ì˜ ì§‘í•©

íŠ¸ëœì­ì…˜ì€ ì—¬ëŸ¬ ê°œì˜ `get()` ì‘ì—…ê³¼ ì´ì–´ì„œ ìˆ˜í–‰ë˜ëŠ” `set()`, `update()`, `delete()` ë“±ì˜ ì—¬ëŸ¬ ì“°ê¸° ì‘ì—…ìœ¼ë¡œ êµ¬ì„±ëœë‹¤. ë™ì‹œ ìˆ˜ì •ì˜ ê²½ìš° Firestoreì—ì„œëŠ” ì „ì²´ íŠ¸ëœì­ì…˜ì„ ë‹¤ì‹œ ì‹¤í–‰í•œë‹¤. ì˜ˆë¥¼ ë“¤ì–´ í•œ íŠ¸ëœì­ì…˜ì—ì„œ ë¬¸ì„œë¥¼ ì½ê³  ë‹¤ë¥¸ í´ë¼ì´ì–¸íŠ¸ê°€ ê·¸ ë¬¸ì„œë¥¼ ìˆ˜ì •í•˜ëŠ” ê²½ìš° FirestoreëŠ” í•´ë‹¹ íŠ¸ëœì­ì…˜ì„ ë‹¤ì‹œ ì‹œë„í•œë‹¤. ê·¸ë˜ì„œ **íŠ¸ëœì­ì…˜ì´ í•­ìƒ ì¼ê´€ëœ ìµœì‹  ë°ì´í„°ë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤.**

[ì°¸ê³  : runTransaction](https://firebase.google.com/docs/reference/js/firebase.firestore.Firestore#runtransaction)

> runTransaction (updateFuction : (transaction) => Promise ): Promise

```js
const sfDocRef = db.collection('cities').doc('SF')

return db.runTransaction(transaction => {
  return transaction // transaction.get(documentRef) : DocumentSnapshot
    .get(sfDocRef)
    .then(sfDoc => {
      if (!sfDoc.exists) {
        throw 'Document does not exist'
      }

      let newPopulation = sfDoc.data().population + 1
      transaction.update(sfDocRef, { population: newPopulation })
    })
    .then(() => {
      console.log('Transaction successfully committed')
    })
})
```

### QuerySnapshot, DocumentSnapshot

- ì—¬ëŸ¬ ë¬¸ì„œë¥¼ query í•˜ëŠ” ê²½ìš°

  ```js
  const museumsQuery = db.collection('landmarks').where('type', '==', 'museum') // [where return Query](https://firebase.google.com/docs/reference/js/firebase.firestore.Query#where)
  museumsQuery.get().then(querySnapshot => {
    querySnapshot.forEach(doc => {
      console.log(doc.id, '=>', doc.data())
    })
  })
  ```

  - where ë¬¸ì€ Queryë¥¼ return í•œë‹¤. Query ì— í•´ë‹¹í•˜ëŠ” ë°ì´í„°ë¥¼ ë³´ë ¤ë©´ Query.get() ë©”ì†Œë“œë¥¼ ì‹¤í–‰ì‹œí‚¨ë‹¤.
  - get()ì€ Promise QuerySnapshotì„ return í•œë‹¤.
  - QuerySnapshotì€ 0 ë˜ëŠ” ì—¬ëŸ¬ê°œì˜ DocumentSnapshot objectë¥¼ ê°€ì§€ê³  ìˆë‹¤.
  - ì—¬ëŸ¬ê°œì˜ documentsëŠ” `docs` propertyë‚˜ forEach methodë¡œ array ì²˜ëŸ¼ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.
  - QueryDocumentSnapshotì€ `.data()` ë˜ëŠ” `.get(field)` ë¡œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.=
